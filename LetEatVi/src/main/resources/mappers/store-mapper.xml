<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="store">

	<select id="selectAllProductCount" resultType="_int">
		SELECT COUNT(*)
		FROM PRODUCT
	</select>
	
	<select id="selectProduct" resultType="prod">
		SELECT PNO, PNAME, PPRICE, PCONTENT, PCNAME
		FROM PRODUCT P, PCATEGORY C
		WHERE P.PTYPE = C.PCTYPE
	</select>
	
	<select id="selectOneProduct" parameterType="_int" resultType="prod">
		SELECT PNO, PNAME, PPRICE, PCONTENT, PCNAME
		FROM PRODUCT P, PCATEGORY C
		WHERE P.PTYPE = C.PCTYPE
		AND P.PNO = #{pno}
	</select>

	<select id="selectCategory" parameterType="_int" resultType="prod">
		SELECT PNO, PNAME, PPRICE, PCONTENT, PCNAME
		FROM PRODUCT P, PCATEGORY C
		WHERE P.PTYPE = C.PCTYPE
		AND C.PCTYPE = #{cno}
	</select>
	
	<select id="selectAllCategory" resultType="prod">
		SELECT PNO, PNAME, PPRICE, PCONTENT, PCNAME
		FROM PRODUCT P, PCATEGORY C
		WHERE P.PTYPE = C.PCTYPE
	</select>
	
	<select id="selectOneMember" parameterType="string" resultType="Member">
		SELECT USERNAME, EMAIL, PHONE
		FROM MEMBER
		WHERE USERID = #{userId}
	</select>
	
 	<insert id="insertPaymentInfo" parameterType="Payment">
		INSERT INTO PAYMENT VALUES(#{orderPerson}, #{orderEmail}, #{orderPhone}, #{receiptPerson}, #{receiptPhone}, #{receiptAddress})	
	</insert>
	
	<insert id="insertOneCart" parameterType="Cart">
		INSERT INTO CART VALUES(SEQ_CART_ID.NEXTVAL, #{userId}, #{pno}, DEFAULT)
	</insert>
	
	<select id="selectOneCart" parameterType="Cart" resultType="_int">
		SELECT COUNT(*)
		FROM CART
		WHERE USERID = #{userId}
		AND PNO = #{pno}
	</select>
	
	<delete id="deleteCart" parameterType="Cart">
		DELETE 
		FROM CART
		WHERE USERID = #{userId}
		AND PNO = #{pno}
	</delete>
	
	<insert id="insertOneCartWithQuantity" parameterType="Cart">
		INSERT INTO CART VALUES(SEQ_CART_ID.NEXTVAL, #{userId}, #{pno}, #{cquantity})
	</insert>
	
	<select id="selectAllCart" parameterType="string" resultType="Cart">
		SELECT * FROM PRODUCT P,
		(   SELECT *
    		FROM CART
    		WHERE USERID = #{userId} ) B
		WHERE P.PNO = B.PNO
	</select>
</mapper>